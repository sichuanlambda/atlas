# 2026-02-21 — Atlas Daily Log

### Carried Over from Feb 20 (Late Night)
- Nathan reviewing the "Explore City Architecture Guides" section on AH homepage (step1.html.erb)
- Asked to update it but hasn't specified what changes yet - waiting for direction

### Thumbnail System — LIVE (Feb 21)
- Nathan asked to fix slow page loads due to heavy images
- Root cause: S3 images served at full size (some 3MB+), no thumbnails
- PR #20's thumbnail system was partially built but disabled
- What existed: `thumbnail_url` Ruby helper (returning original URL), `thumbUrl` JS function, onerror fallbacks in views
- What I did:
  1. Enabled the helper to return actual `/uploads/thumbs/{base}_400w{ext}` URLs
  2. Pushed to Heroku (commit 613fb44)
  3. Ran `rake images:generate_thumbnails` — 230 new + 264 existing = 494 total, 3 failed (.php files)
- Result: listing pages now serve ~30-50KB thumbs instead of 1-3MB originals. ~80-90% page weight reduction.
- Full-size images still load on building detail pages
- 592 total buildings in DB, 586 with images, 553 on S3

### Pinterest Cron — Broken (Feb 21)
- 3 consecutive failures today (9am, 1pm, 5pm UTC) — browser service unavailable
- Chrome extension relay running but no tab connected
- 0/4 pins posted today. Chrysler Building stuck at queue position #1
- Needs manual browser troubleshooting to restore
- Current state: basic grid of all 13 cities, no featured/hierarchy
- Working branch: /tmp/feedback-loop on fix-places branch, synced with GitHub + Heroku

### Key Context
- Place model uses `building_analyses_in_place` NOT `building_analyses` - recurring bug source
- PRs merged today: #22 (city guides on homepage), #23 (places index redesign)
- GitHub and Heroku now in sync after multiple force-pushes
- All cron jobs on Sonnet/Haiku, sub-agents on Sonnet, main session on Opus
- Compaction triggers at ~50K tokens (reserveTokensFloor=150K)
- Google Indexing API live, 49+ URLs submitted
- Dashboard analytics page built by sub-agent (cost tracking, agents & cron page)

### Pinterest Cron Failing (09:00 UTC)
- Pinterest cron tried to restart gateway to fix browser - doesn't have permission
- commands.restart=true needed in config, or cron needs different approach to browser issues
- Pins not posting - browser timeout is recurring issue
- Need to investigate: is browser actually needed? Or can we use API/web_fetch for Pinterest?

### Haiku Model Fix (10:48 UTC)
- Haiku model name was wrong: `anthropic/claude-haiku-3-5-20241022` doesn't exist
- Changed to `anthropic/claude-haiku-3-5-latest` in both config and heartbeat cron
- Heartbeat had 17 consecutive errors from the bad model name
- Fixed both gateway config + cron job (3aad1143)

### Thumbnail Activation & Deploy (~14:09 UTC)
- Enabled thumbnail URLs for building images (commit 613fb44)
- Ran rake images:generate_thumbnails on Heroku — processed buildings successfully
- Thumbnails stored as `uploads/thumbs/original_400w.jpg` in S3

### Remove Homepage Stats (~19:30 UTC)
- Nathan requested removing building & city count from top of homepage (step1 page)
- Removed `cg-stats` div showing Cities count and Buildings count from City Architecture Guides section
- Also removed count from "View All City Guides" button text
- Deployed as v394 (commit ff70ae7)
