# 2026-02-18 — Atlas Daily Log

## Key Events
- PR #18 (Performance & SEO) merged & deployed by Nathan
- SSL fixed on cresoftware.tech (enabled HTTPS enforcement via GitHub API)

### Evening Session (~19:00-19:40 UTC)
- **Pinterest queue loaded**: Added 17 NYC buildings (935-952) + 2 DC buildings (954-955) to queue. Total queue now 25. Created NYC Architecture and Washington DC Architecture boards. Updated cron to auto-create boards on Pinterest when encountering new cities.
- **Philly resubmission already done!** Sub-agent successfully submitted 18 buildings (IDs 993-1011) with Wikimedia URLs. Made all visible via admin bulk action. PSFS Building (#1008) verified — real image, full GPT analysis, looks great.
- **Old Philly/Boston buildings (957-986)**: All already hidden from prior work.
- **Boston resubmission started**: Trinity Church (#1012) and Boston Public Library (#1013) submitted with Wikimedia URLs + addresses added. 2/18 complete, 16 remaining.
- **Browser issues**: VPS hit load avg 6.71 with only 187MB free RAM. Killed Chrome processes to recover (freed to 2.7GB). Browser works but stale refs cause timeouts — always re-snapshot after navigation.
- **Nathan asked about OpenClaw business models** — gave him a layered analysis (infrastructure → runtime → skills → agents → solutions) with 5 revenue models. Highlighted CRE-specific agent as natural fit given his background + existing zoning data.

### Boston Submission Progress
- Building 1: Trinity Church #1012 ✅
- Building 2: Boston Public Library #1013 ✅  
- Buildings 3-18: Still pending (Faneuil Hall through Christian Science Center)
- Using corrected flow: name + external URL → blur → click submit → add address via "Add Location"
- 60s spacing between submissions to avoid Heroku/Sidekiq overload

### Key Learnings
- Sub-agents CAN submit buildings if they use evaluate() approach (not ref-based clicks which need snapshots). The Philly sub-agent succeeded despite earlier belief it would fail.
- Always kill Chrome when done — it eats all RAM on 4GB VPS
- Stale refs are the #1 cause of "browser timeout" errors — re-snapshot after every navigation
- Dashboard: added Last Updated bar, clickable Pinterest board links, real metrics from Nathan's screenshot
- Created 6 runbooks in memory/runbooks/ for repeatable tasks
- Hetzner API token configured by Nathan in dashboard

## Building Submission Discovery
- **Root cause found**: entering an address in the form triggers Street View auto-fetch which OVERRIDES any uploaded image
- **ALL Philly buildings (957-974)** had Street View images — need resubmission
- **ALL Boston buildings (975-986)** had Street View images — need resubmission (overnight agent used address + Street View)
- **DC buildings (954-956)** — some have real images (submitted properly early on)
- **Correct flow**: submit image first (via external URL field e8) WITHOUT address, then add address via "Update Location" on the show page
- **File upload via browser automation doesn't work reliably** — headless Chrome `upload` tool sets files but `files.length` returns 0
- Documented in memory/runbooks/building-submission.md

## Building Resubmission Status
- Hid old bad Wanamaker (#968, logo image) and Eastern State (#962, tiny image)
- Compiled Wikimedia Commons URLs for all 36 Philly + Boston buildings
- Sub-agent "city-resubmit" spawned to handle bulk resubmission with corrected flow
- Test submission (#987 "Trinity Church TEST") used external URL — GPT analysis works but image shows broken on site (Wikimedia blocks hotlinking)

## Pinterest Status
- 7 pins published (all New Orleans), 7 remaining in queue
- Real metrics from Nathan's screenshot: 52 impressions, 7 saves, 5 clicks
- Pontalba Buildings leading (14 impressions) — style board cross-posting helps
- Cron posting 4x daily, working correctly
- Dashboard Pinterest section updated with real data
- Board links now clickable on dashboard

## CRE Software
- All 174 products enriched (completed overnight by sub-agents)
- SSL cert fixed — HTTPS enforcement enabled via GitHub Pages API
- Site loads correctly at https://cresoftware.tech

## Vision Docs
- Sub-agent spawned to write vision/roadmap/GTM for Architecture Helper and CRE Software
- Pending completion → will be in memory/vision-architecture-helper.md and memory/vision-cresoftware.md

## Sub-Agents Running at End of Day
- city-resubmit: hiding bad buildings + resubmitting Philly/Boston with Wikimedia URLs
- vision-docs: writing vision/roadmap docs

## Cron Jobs Active
| ID | Name | Schedule | Status |
|----|------|----------|--------|
| bc621e88 | Pinterest: Post pins | 4x daily (09/13/17/21 UTC) | ✅ Working |
| 9bfc068d | Pinterest: Performance review | Every 3 days | ✅ Working |
| 3aad1143 | Atlas heartbeat | Every 30 min | ✅ Working |

## Blocked on Nathan
- Enable Web Search Indexing API in Google Cloud Console (project stoked-virtue-413221)

## Key Lesson
**Write runbooks.** Every repeatable task should have a documented procedure. Today's building submission disaster could have been avoided if the first successful DC submission had been documented step-by-step. Created 6 runbooks to prevent this going forward.

### Late Evening Session (~20:00-22:15 UTC)

**Boston Submission Completed (Playwright script)**
- Buildings 3-18 submitted via standalone Playwright script using OpenClaw's persistent browser context (cookies)
- Key insight: `launchPersistentContext(USER_DATA_DIR)` gives Playwright access to OpenClaw browser's cookies — no login needed
- All 16 buildings succeeded: Faneuil Hall (#1014) through Christian Science Center (#1029)
- 60s spacing between submissions, total ~16 minutes autonomous

**Address Geocoding Fix**
- Playwright's `evaluate()` approach for clicking "Add Location" didn't actually submit the Rails form
- Fixed via curl: GET show page for CSRF token, POST patch with address for each building
- First attempt got 422s (CSRF rotation) — fixed by getting fresh CSRF per request via cookie jar
- All 16 Boston addresses geocoded successfully
- Philly buildings (993-1011) confirmed already geocoded by the sub-agent

**Boston Place Page Created**
- Created via curl POST to admin/places endpoint
- Added editorial content about Boston's architectural history
- Verified live at /places/boston with 18 buildings on map

**Image Migration Saga**
- PR #19 merged: external URLs → S3 on submission (one-line fix in controller)
- `migrate_external` rake task: NYC + DC migrated to S3 ✅
- Philly/Boston failed: Wikimedia 404s (bad thumbnail URLs) and 429s (rate limiting)
- Built `fix_broken_images` task: searches Wikimedia Commons API by building name, downloads, uploads to S3
- Downloaded all 30 missing images on VPS via Commons search API (29/30 first pass, got #30 manually)
- BUT can't upload to S3 from VPS without AWS credentials
- Nathan doesn't have time to share creds tonight — added to his todo list
- `reanalyze_missing` task also written for re-running failed GPT analyses

**Atlas Control Center v2**
- Today's Summary card with structured sections on Overview page
- "Waiting on Nathan" section with prioritized action items
- Chat system: multiple conversation threads, localStorage persistence, bubble UI
- All metrics updated: 10 cities, ~530 buildings, 19 PRs, 9 pins, 43 queued
- Recent activity timeline with timestamps
- Cron: dashboard auto-refresh every 3 hours (ID: c51c6094)

**Nathan asked about OpenClaw business models**
- Gave layered analysis: infrastructure → runtime → skills → agents → solutions
- 5 revenue models: managed hosting, skills marketplace, vertical agents, agency/consulting, wrapper products
- Highlighted CRE-specific AI agent as natural fit for his background + existing zoning data
- Key insight: "you're living the case study" — AH growth story IS the pitch deck

**Cron Inventory Update**
- Pinterest posting: bc621e88 (4x daily)
- Pinterest review: 9bfc068d (every 3 days)
- Atlas heartbeat: 3aad1143 (every 30 min)
- Hourly status: 0f53741f (every hour) — NOTE: this cron is out of date, doesn't know about session work
- Dashboard refresh: c51c6094 (every 3 hours) — NEW

**Critical Learnings**
- `launchPersistentContext()` with OpenClaw's user-data dir = Playwright with auth cookies. Game changer for automation.
- Rails geocoding happens via `after_validation :geocode` — JS evaluate() doesn't trigger Rails form submission properly. Use curl with CSRF tokens instead.
- Wikimedia rate limits per IP: Heroku gets 429'd after ~15 downloads. VPS gets 429'd after ~30. Use Commons search API (different endpoint) + 5s delays.
- The hourly status cron runs in isolation and doesn't know about main session work — it reports stale info. Consider updating it or replacing with dashboard refresh.

**Building ID Ranges (updated)**
- SF/Chicago: 868-884
- NOLA: 921-934
- NYC: 935-952
- DC: 954-956
- Old Philly (hidden, Street View): 957-974
- Old Boston (hidden, Street View): 975-986
- New Philly (Wikimedia, visible): 993-1011
- New Boston (Wikimedia, visible): 1012-1029

### Overnight Work (Feb 19, ~03:00-04:00 UTC)

**Hourly cron reduced**: Was firing every hour with nothing to report, burning tokens. Changed to 4x daily (09/13/17/21 UTC).

**PR #20: Image Performance**
- Created `thumbnail_url` Ruby helper + JS `thumbUrl()` function
- Maps S3 image URLs to `/uploads/thumbs/{name}_400w.{ext}` variants
- Added `images:generate_thumbnails` rake task (MiniMagick, 400w, 85% quality)
- Updated Place pages (cards, sidebar, map popups) + building library to use thumbnails
- Added width/height for CLS, lazy loading everywhere
- Expected impact: ~90% page weight reduction on Place pages
- Nathan needs to merge PR #20, deploy, then `heroku run rake images:generate_thumbnails`

**Sub-agents spawned:**
1. `morning-briefing`: Writing 5 strategic docs Nathan requested (CRE SaaS plan, skills ranking, dashboard ideas, engagement ideas, money-making ideas)
2. `cre-expansion`: Researching 30-50 new CRE software products to add to directory

**fix_broken_images results** (Nathan ran it):
- 25/33 fixed (migrated to S3)
- 8 failed (Commons search misses): Elfreth's Alley ×2, Comcast Tech Center, Cathedral Basilica, Trinity Church, John Hancock Tower, Isabella Stewart Gardner Museum, MIT Stata Center
- Still need manual image sourcing for these 8

**Morning briefing completed**: 5 strategic docs written in memory/nathan-morning-briefing.md
1. CRE OpenClaw SaaS plan (architecture, pricing, GTM, what Atlas can build 99% alone)
2. Skills & integrations ranked (top 3: Heroku CLI, Email, Google Search Console)
3. Dashboard improvements (Decision Queue is the killer feature)
4. Engagement ideas (low-friction decision queue + inline Telegram approvals)
5. Money-making ideas (Tier 1 NOW: Zoning API + DFY reports + SEO affiliate = $3-15K/mo)

**7 remaining broken images sourced**: Found all on Wikimedia Commons via API search
- Added fix_batch rake task to PR #20 with hardcoded URLs
- Nathan just needs: merge PR #20, deploy, `heroku run rake images:fix_batch`

**CRE expansion sub-agent running**: Researching 30-50 new products
